<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rabbit Cage Management</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .hidden { display: none; }
        .highlight { font-weight: bold; border: 2px solid black; padding: 5px; }
    </style>
</head>
<body>
    <header>
        <button onclick="goHome()">&#x1F3E0;</button>
        <span>Rabbit Cage Management</span>
    </header>

    <div id="cageDetails">
        <form id="rabbitForm" onsubmit="saveData(event)">
            <!-- Profile Selector -->
            <div>
                <label for="profile">RABBIT PROFILE:</label>
                <select id="profile" name="profile" onchange="toggleProfileFields()">
                    <option value="doe">Rabbit Doe</option>
                    <option value="fattener">Rabbit Fattener</option>
                    <option value="breeder">Rabbit Breeder</option>
                </select>
            </div>

            <!-- Rabbit Doe Fields -->
            <div id="doeFields" class="hidden">
                <div><label for="serialNumber">SERIAL NUMBER:</label><input type="text" id="serialNumber" name="serialNumber"></div>
                <div><label for="age">AGE:</label><input type="text" id="age" name="age"></div>
                <div><label for="dateOfBirth">DATE OF BIRTH:</label><input type="date" id="dateOfBirth" name="dateOfBirth"></div>
                <div>
                    <label for="gender">GENDER:</label>
                    <select id="gender" name="gender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div><label for="family">RABBIT FAMILY:</label><input type="text" id="family" name="family"></div>
                <div>
                    <label for="foodIntake">FOOD INTAKE:</label>
                    <label><input type="radio" name="foodIntakeDoe" value="normal"> NORMAL</label>
                    <label><input type="radio" name="foodIntakeDoe" value="irregular"> IRREGULAR</label>
                </div>
                <div><label for="weight">WEIGHT:</label><input type="text" id="weight" name="weight"></div>
                <div id="pregnantSection" class="hidden">
                    <label>PREGNANT:</label>
                    <label><input type="radio" name="pregnantDoe" value="yes" onclick="togglePregnancyDetails(true)"> YES</label>
                    <label><input type="radio" name="pregnantDoe" value="no" onclick="togglePregnancyDetails(false)"> NO</label>
                    <div id="pregnancyDetails" class="hidden">
                        <div><label for="pregnancyStartDoe">START OF PREGNANCY:</label><input type="date" id="pregnancyStartDoe" name="pregnancyStartDoe" onchange="calculateDueDate('Doe')"></div>
                        <div><label for="dueDateDoe">DUE DATE OF PREGNANCY:</label><input type="text" id="dueDateDoe" name="dueDateDoe" readonly></div>
                    </div>
                    <div id="notReadyMessage" class="hidden">
                        <p>This rabbit is not ready for pregnancy.</p>
                    </div>
                </div>
            </div>

            <!-- Rabbit Fattener Section -->
            <div id="fattenerSection" class="hidden">
                <div>
                    <label for="foodIntakeFattener">FOOD INTAKE:</label>
                    <label><input type="radio" name="foodIntakeFattener" value="normal"> NORMAL</label>
                    <label><input type="radio" name="foodIntakeFattener" value="irregular"> IRREGULAR</label>
                </div>
                <div id="readyForMeat" class="hidden">
                    <p>This rabbit is ready for meat production.</p>
                </div>
                <div id="notReadyForMeat" class="hidden">
                    <p class="highlight">This rabbit is not ready for meat production.</p>
                </div>
            </div>

            <!-- Rabbit Breeder Section -->
            <div id="breederSection" class="hidden">
                <div>
                    <label>ELIGIBLE FOR MATING:</label>
                    <label><input type="radio" name="matingBreeder" value="yes"> YES</label>
                    <label><input type="radio" name="matingBreeder" value="no"> NO</label>
                </div>
            </div>

            <div>
                <label for="note">NOTE:</label>
                <textarea id="note" name="note"></textarea>
            </div>
            <div class="buttons">
                <button type="submit">SUBMIT</button>
                <button type="button" onclick="goHome()">CANCEL</button>
            </div>
        </form>
    </div>

    <div id="homePage" class="cage-list hidden">
        <button onclick="showCageDetails(1)">CAGE 1</button>
        <button onclick="showCageDetails(2)">CAGE 2</button>
        <button onclick="showCageDetails(3)">CAGE 3</button>
        <button onclick="showCageDetails(4)">CAGE 4</button>
    </div>

    <script>
        const elements = {
            homePage: document.getElementById('homePage'),
            cageDetails: document.getElementById('cageDetails'),
            rabbitForm: document.getElementById('rabbitForm'),
            profileSelect: document.getElementById('profile'),
            pregnancyDetails: document.getElementById('pregnancyDetails'),
            notReadyMessage: document.getElementById('notReadyMessage'),
            doeFields: document.getElementById('doeFields'),
            fattenerSection: document.getElementById('fattenerSection'),
            breederSection: document.getElementById('breederSection'),
            readyForMeat: document.getElementById('readyForMeat'),
            notReadyForMeat: document.getElementById('notReadyForMeat')
        };

        function goHome() {
            elements.homePage.classList.remove('hidden');
            elements.cageDetails.classList.add('hidden');
            resetFields();
        }

        function showCageDetails(cageNumber) {
            elements.homePage.classList.add('hidden');
            elements.cageDetails.classList.remove('hidden');
            loadData(cageNumber);
            elements.rabbitForm.dataset.cageNumber = cageNumber;
        }

        function togglePregnancyDetails(show) {
            elements.pregnancyDetails.classList.toggle('hidden', !show);
            elements.notReadyMessage.classList.toggle('hidden', show);
        }

        function toggleProfileFields() {
            const profile = elements.profileSelect.value;
            elements.doeFields.classList.toggle('hidden', profile !== 'doe');
            elements.fattenerSection.classList.toggle('hidden', profile !== 'fattener');
            elements.breederSection.classList.toggle('hidden', profile !== 'breeder');
        }

        function calculateDueDate(profileType) {
            const pregnancyStartId = `pregnancyStart${profileType}`;
            const dueDateId = `dueDate${profileType}`;
            const pregnancyStart = document.getElementById(pregnancyStartId).value;

            if (pregnancyStart) {
                const startDate = new Date(pregnancyStart);
                startDate.setDate(startDate.getDate() + 30); // Add 30 days for due date
                document.getElementById(dueDateId).value = startDate.toISOString().split('T')[0]; // Format as YYYY-MM-DD
            }
        }

        function resetFields() {
            elements.rabbitForm.reset();
            toggleProfileFields(); // Reset visibility of profile fields
            elements.pregnancyDetails.classList.add('hidden');
            elements.notReadyMessage.classList.add('hidden');
            elements.readyForMeat.classList.add('hidden');
            elements.notReadyForMeat.classList.add('hidden');
        }

        function saveData(event) {
            event.preventDefault();
            const cageNumber = elements.rabbitForm.dataset.cageNumber;
            const data = new FormData(elements.rabbitForm);
            const obj = Object.fromEntries(data.entries()); // Convert FormData to Object
            localStorage.setItem(`cageData${cageNumber}`, JSON.stringify(obj));
            goHome();
        }

        function loadData(cageNumber) {
            const data = JSON.parse(localStorage.getItem(`cageData${cageNumber}`));
            if (data) {
                Object.entries(data).forEach(([key, value]) => {
                    const field = elements.rabbitForm.elements[key];
                    if (field) {
                        if (field.type === 'radio') {
                            field.value === value && (field.checked = true);
                        } else {
                            field.value = value;
                        }
                    }
                });
                elements.profileSelect.value = data['profile'];
                toggleProfileFields();  // Update the visible fields based on the loaded profile
                
                // Check for pregnancy state
                if (data['profile'] === 'doe') {
                    togglePregnancyDetails(data['pregnantDoe'] === 'yes');
                }
            } else {
                resetFields();
            }
        }
    </script>
</body>
</html>

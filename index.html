<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rabbit Cage Management</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <button onclick="goHome()">&#x1F3E0;</button>
        <span>Rabbit Cage Management</span>
    </header>

    <div id="cageDetails" style="display: none;">
        <form id="rabbitForm" onsubmit="saveData(event)">
            <!-- Profile Selector -->
            <div>
                <label for="profile">RABBIT PROFILE:</label>
                <select id="profile" name="profile" onchange="toggleProfileFields()">
                    <option value="doe">Rabbit Doe</option>
                    <option value="fattener">Rabbit Fattener</option>
                    <option value="breeder">Rabbit Breeder</option>
                </select>
            </div>

            <!-- Rabbit Doe Fields -->
            <div id="doeFields" style="display: none;">
                <div>
                    <label for="serialNumber">SERIAL NUMBER:</label>
                    <input type="text" id="serialNumber" name="serialNumber">
                </div>
                <div>
                    <label for="age">AGE:</label>
                    <input type="text" id="age" name="age">
                </div>
                <div>
                    <label for="dateOfBirth">DATE OF BIRTH:</label>
                    <input type="date" id="dateOfBirth" name="dateOfBirth">
                </div>
                <div>
                    <label for="gender">GENDER:</label>
                    <select id="gender" name="gender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div>
                    <label for="family">RABBIT FAMILY:</label>
                    <input type="text" id="family" name="family">
                </div>
                <div>
                    <label>FOOD INTAKE:</label>
                    <label><input type="radio" name="foodIntakeDoe" value="normal"> NORMAL</label>
                    <label><input type="radio" name="foodIntakeDoe" value="irregular"> IRREGULAR</label>
                </div>
                <div>
                    <label for="weight">WEIGHT:</label>
                    <input type="text" id="weight" name="weight">
                </div>
                <div id="pregnantSection">
                    <label>PREGNANT:</label>
                    <label><input type="radio" name="pregnantDoe" value="yes" onclick="togglePregnancyDetails(true)"> YES</label>
                    <label><input type="radio" name="pregnantDoe" value="no" onclick="togglePregnancyDetails(false)"> NO</label>
                    <div id="pregnancyDetails" style="display: none;">
                        <div>
                            <label for="pregnancyStartDoe">START OF PREGNANCY:</label>
                            <input type="date" id="pregnancyStartDoe" name="pregnancyStartDoe" onchange="calculateDueDate('Doe')">
                        </div>
                        <div>
                            <label for="dueDateDoe">DUE DATE OF PREGNANCY:</label>
                            <input type="text" id="dueDateDoe" name="dueDateDoe" readonly>
                        </div>
                    </div>
                    <div id="notReadyMessage" style="display: none;">
                        <p>This rabbit is not ready for pregnancy.</p>
                    </div>
                </div>
            </div>

            <!-- Rabbit Fattener Section -->
            <div id="fattenerSection" style="display: none;">
                <div>
                    <label for="serialNumberFattener">SERIAL NUMBER:</label>
                    <input type="text" id="serialNumberFattener" name="serialNumberFattener">
                </div>
                <div>
                    <label for="breeds">BREEDS:</label>
                    <input type="text" id="breeds" name="breeds">
                </div>
                <div>
                    <label for="ageFattener">AGE:</label>
                    <input type="text" id="ageFattener" name="ageFattener">
                </div>
                <div>
                    <label for="dateOfBirthFattener">DATE OF BIRTH:</label>
                    <input type="date" id="dateOfBirthFattener" name="dateOfBirthFattener" onchange="checkMeatProduction()">
                </div>
                <div>
                    <label for="genderFattener">GENDER:</label>
                    <select id="genderFattener" name="genderFattener">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div>
                    <label for="familyFattener">RABBIT FAMILY:</label>
                    <input type="text" id="familyFattener" name="familyFattener">
                </div>
                <div>
                    <label>FOOD INTAKE:</label>
                    <label><input type="radio" name="foodIntakeFattener" value="normal"> NORMAL</label>
                    <label><input type="radio" name="foodIntakeFattener" value="irregular"> IRREGULAR</label>
                </div>
                <div>
                    <label for="weightFattener">WEIGHT:</label>
                    <input type="text" id="weightFattener" name="weightFattener">
                </div>
                <div id="readyForMeat" style="display: none;">
                    <p>This rabbit is ready for meat production.</p>
                </div>
                <div id="notReadyForMeat" style="display: none;">
                    <p style="font-weight: bold; border: 2px solid black; padding: 5px;">This rabbit is not ready for meat production.</p>
                </div>
            </div>

            <!-- Rabbit Breeder Section -->
            <div id="breederSection" style="display: none;">
                <div>
                    <label>ELIGIBLE FOR MATING:</label>
                    <label><input type="radio" name="matingBreeder" value="yes"> YES</label>
                    <label><input type="radio" name="matingBreeder" value="no"> NO</label>
                </div>
            </div>

            <div>
                <label for="note">NOTE:</label>
                <textarea id="note" name="note"></textarea>
            </div>
            <div class="buttons">
                <button type="submit">SUBMIT</button>
                <button type="button" onclick="clearForm()">CLEAR FORM</button>
                <button type="button" onclick="goHome()">CANCEL</button>
            </div>
            <div class="buttons">
                <button type="button" onclick="deleteRabbitData()">DELETE CAGE DATA</button>
            </div>
        </form>
    </div>

    <div id="homePage" class="cage-list" style="display: block;">
        <h2>CAGE MANAGEMENT</h2>
        <div id="cageButtons"></div> <!-- Container for dynamic cage buttons -->
        <button type="button" onclick="addCage()">ADD CAGE</button>
    </div>

    <script>
        const elements = {
            homePage: document.getElementById('homePage'),
            cageDetails: document.getElementById('cageDetails'),
            rabbitForm: document.getElementById('rabbitForm'),
            profileSelect: document.getElementById('profile'),
            pregnancyDetails: document.getElementById('pregnancyDetails'),
            notReadyMessage: document.getElementById('notReadyMessage'),
            doeFields: document.getElementById('doeFields'),
            fattenerSection: document.getElementById('fattenerSection'),
            breederSection: document.getElementById('breederSection'),
            readyForMeat: document.getElementById('readyForMeat'),
            notReadyForMeat: document.getElementById('notReadyForMeat'),
            cageButtons: document.getElementById('cageButtons')
        };

        let cageCount = 0; // To keep track of the number of cages
        let rabbitDataList = []; // To store all rabbit data

        // Initialize the form
        window.onload = function() {
            toggleProfileFields(); // Ensure the correct fields are displayed on page load
        };

        function goHome() {
            elements.homePage.style.display = 'block';
            elements.cageDetails.style.display = 'none';
            resetFields();
        }

        function showCageDetails(cageNumber) {
            elements.homePage.style.display = 'none';
            elements.cageDetails.style.display = 'block';
            loadData(cageNumber);
        }

        function addCage() {
            cageCount++;
            const cageButton = document.createElement('button');
            cageButton.innerText = `CAGE ${cageCount}`;
            cageButton.onclick = () => showCageDetails(cageCount);
            elements.cageButtons.appendChild(cageButton);
            resetFields(); // Reset fields when adding a new cage
        }

        function resetFields() {
            elements.rabbitForm.reset();
            elements.doeFields.style.display = 'none';
            elements.fattenerSection.style.display = 'none';
            elements.breederSection.style.display = 'none';
            elements.notReadyMessage.style.display = 'none';
            elements.readyForMeat.style.display = 'none';
            elements.notReadyForMeat.style.display = 'none';
            elements.pregnancyDetails.style.display = 'none';
        }

        function loadData(cageNumber) {
            const data = rabbitDataList[cageNumber - 1] || {};
            // Load data into the form fields
            elements.profileSelect.value = data.profile || "doe"; // Set default profile if undefined
            elements.rabbitForm.serialNumber.value = data.serialNumber || "";
            elements.rabbitForm.age.value = data.age || "";
            elements.rabbitForm.dateOfBirth.value = data.dateOfBirth || "";
            elements.rabbitForm.gender.value = data.gender || "";
            elements.rabbitForm.family.value = data.family || "";
            elements.rabbitForm.weight.value = data.weight || "";
            elements.rabbitForm.foodIntakeDoe.value = data.foodIntake || "";

            // Show the appropriate fields
            toggleProfileFields(); // Call this function to show/hide fields based on selected profile
        }

        function toggleProfileFields() {
            const profileValue = elements.profileSelect.value;
            // Reset visibility of all sections
            elements.doeFields.style.display = 'none';
            elements.fattenerSection.style.display = 'none';
            elements.breederSection.style.display = 'none';

            // Show fields based on selected profile
            if (profileValue === 'doe') {
                elements.doeFields.style.display = 'block';
            } else if (profileValue === 'fattener') {
                elements.fattenerSection.style.display = 'block';
            } else if (profileValue === 'breeder') {
                elements.breederSection.style.display = 'block';
            }
        }

        function saveData(event) {
            event.preventDefault();
            const currentCageNumber = Array.from(elements.cageButtons.children).findIndex(
                button => button.innerText.includes(`CAGE ${cageCount}`)) + 1;

            const rabbitData = {
                profile: elements.profileSelect.value,
                serialNumber: elements.rabbitForm.serialNumber.value,
                age: elements.rabbitForm.age.value,
                dateOfBirth: elements.rabbitForm.dateOfBirth.value,
                gender: elements.rabbitForm.gender.value,
                family: elements.rabbitForm.family.value,
                weight: elements.rabbitForm.weight.value,
                foodIntake: elements.rabbitForm.foodIntakeDoe.value,
            };

            rabbitDataList[currentCageNumber - 1] = rabbitData; // Save data in the list
            alert('Data saved successfully!');
        }

        function clearForm() {
            elements.rabbitForm.reset();
            resetFields();
        }

        function deleteRabbitData() {
            const currentCageNumber = Array.from(elements.cageButtons.children).findIndex(
                button => button.innerText.includes(`CAGE ${cageCount}`)) + 1;

            rabbitDataList[currentCageNumber - 1] = {}; // Clear data for the cage
            alert('Cage data deleted!');
            resetFields();
        }

        function togglePregnancyDetails(show) {
            elements.pregnancyDetails.style.display = show ? 'block' : 'none';
        }

        function calculateDueDate(type) {
            const startDate = document.getElementById(`pregnancyStart${type}`);
            const dueDateField = document.getElementById(`dueDate${type}`);
            if (startDate.value) {
                const start = new Date(startDate.value);
                const dueDate = new Date(start.setMonth(start.getMonth() + 4)); // Assuming a 4-month pregnancy
                dueDateField.value = dueDate.toISOString().split('T')[0]; // Format to YYYY-MM-DD
            }
        }

        function checkMeatProduction() {
            const dateOfBirthField = document.getElementById('dateOfBirthFattener');
            const currentDate = new Date();
            if (dateOfBirthField.value) {
                const ageInMonths = (currentDate - new Date(dateOfBirthField.value)) / (1000 * 60 * 60 * 24 * 30);
                if (ageInMonths >= 6) {
                    elements.readyForMeat.style.display = 'block';
                    elements.notReadyForMeat.style.display = 'none';
                } else {
                    elements.notReadyForMeat.style.display = 'block';
                    elements.readyForMeat.style.display = 'none';
                }
            }
        }
    </script>
</body>
</html>
